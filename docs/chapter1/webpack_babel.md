# æ‰“åŒ… ES6 ä»£ç 

è¿™ä¸€èŠ‚æˆ‘ä»¬è®²ä¸€ä¸‹ä½¿ç”¨ **`Babel`** å¤„ç† `ES6` çš„è¯­æ³•ã€‚



## ä¸¾ä¸ªğŸŒ°ï¼š

é¦–å…ˆæˆ‘ä»¬ä¿®æ”¹ `src/index.js` æ–‡ä»¶ï¼š

```javascript
// index.js

const arr = [
	new Promise(() => {}),
	new Promise(() => {})
];

arr.map(item => {
	console.log(item);
});
```

&nbsp;

æ‰§è¡Œ `npm run bundle`ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å® `promise` çš„ç®­å¤´å‡½æ•° å’Œ `map` è¿™å‡ ä¸ª `es6` çš„è¯­æ³•è¿˜æ˜¯åŸæ ·è¾“å‡ºäº†ï¼š

![](./img/babel1.png)

&nbsp;

æˆ‘ä»¬å°†æ‰“åŒ…å‡ºæ¥çš„ `index.html` åœ¨ `chorme` æ‰“å¼€ï¼Œå‘ç°è¿˜æ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œæ§åˆ¶å°æ‰“å°å‡ºäº†ä¸¤ä¸ª `promise`ï¼š

![](./img/babel2.png)

å› ä¸ºè°·æ­Œæµè§ˆå™¨ä¸æ—¶ä¿±è¿›ï¼Œè¿˜æ˜¯æ”¯æŒå¤§éƒ¨åˆ†çš„ `es6` è¯­æ³•çš„ï¼Œä½†æ˜¯å½“ç¢°åˆ°ä¸€äº›å…¶ä»–çš„æµè§ˆå™¨çš„æ—¶å€™ï¼Œæ¯”å¦‚ `IE` æµè§ˆå™¨ï¼Œé‚£å°± `gg` äº†ã€‚

æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°ä¸€ç§å·¥å…·ï¼Œèƒ½å¸®æˆ‘ä»¬æŠŠ es6 è¯­æ³•çš„ä»£ç è½¬åŒ–ä¸º èƒ½è®©æµè§ˆå™¨è¯†åˆ«çš„ es5 ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦ç”¨åˆ° `babel` äº†ã€‚

&nbsp;

## åœ¨ `webpack` é…ç½® `babel`

æˆ‘ä»¬å¯ä»¥è¿›å…¥ [`Babel`](https://www.babeljs.cn/) çš„å®˜ç½‘ï¼Œæ‰¾åˆ°ç›¸åº”çš„å…³äº `webpack` çš„é…ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š

![](./img/babel3.png)

* é¦–å…ˆå®‰è£…ä¾èµ–ï¼Œ`@babel/core` æ˜¯ `babel` çš„æ ¸å¿ƒæ¨¡å—ï¼Œ`babel-loader` æ˜¯èƒ½ `webpack` ä½¿ç”¨ `babel`ï¼Œ`@babel/preset-env` æ˜¯ `babel` çœŸæ­£å¸®æˆ‘ä»¬è½¬åŒ– es6 ä»£ç çš„æ’ä»¶

```javascript
npm install babel-loader @babel/core @babel/preset-env -D
```

* åœ¨ `webpack.config.js` è¿›è¡Œé…ç½® `babel`ï¼š

```javascript
...
module: {
  rules: [{
    test: /\.js$/,
    exclude: /node_modules/,
    loader: 'babel-loader',
  },
  ...
 ]
}
...
```

* æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ åˆ›å»º `.babelrc`  æ–‡ä»¶æ¥æ›´å¥½çš„ç®¡ç† `babel` çš„é…ç½®

```javascript
// .babelrc
{
	"presets": ["@babel/preset-env"]
}
```

* æœ€åæˆ‘ä»¬é‡æ–°è¿è¡Œä¸€ä¸‹ `npm run bundle`ï¼Œé‡æ–°çœ‹ä¸€ä¸‹ `main.js` æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° `es6` ä»£ç çš„ ç®­å¤´å‡½æ•°å·²ç»è¢«è½¬åŒ–ä¸ºäº†æ™®é€šå‡½æ•°ï¼š

![](./img/babel5.png)



ä½†æ˜¯è¿™é‡Œé¢è¿˜ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬ä¼šå‘ç°ä¸Šè¿°çš„æ‰“åŒ…å‡ºæ¥çš„ä»£ç ä¸­è¿˜æœ‰ `promise` å’Œ `map` å‡½æ•°è¿˜æ²¡æœ‰è¢«è½¬åŒ–ï¼Œæœ‰äº›ä½ç‰ˆæœ¬æµè§ˆå™¨è¿˜ä¸æ”¯æŒè¿™äº›æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŠ ä¸€äº›å«ç‰‡ã€‚



## å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼ˆ`@babel/polyfill`ï¼‰

> ä»Babel 7.4.0å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨æ­¤è½¯ä»¶åŒ…

åŠ äº†å«ç‰‡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä½ç«¯æµè§ˆå™¨å†…ä½¿ç”¨æ–°çš„å†…ç½®å‡½æ•°ï¼Œå¦‚ `Promise` æˆ– `WeakMap`ï¼Œé™æ€æ–¹æ³•å¦‚ `Array.from` æˆ– `Object.assign` ï¼Œå®ä¾‹æ–¹æ³•å¦‚`Array.prototype.includes` ç­‰ç­‰ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨ï¼Œå¦‚æœä½ ä»¬çš„ä¸šåŠ¡éœ€è¦å…¼å®¹ä½ç«¯æµè§ˆå™¨ã€‚ä½†æ˜¯ä½ ä»¬è€æ¿å«ä½ å…¼å®¹ ie6 çš„è¯ï¼Œä»–å¯èƒ½å°±å¸®ä¸äº†ä½ äº†ã€‚

* å®‰è£… `@babel/polyfill`

```javascript
npm install @babel/polyfill -D
```

* åœ¨ `index.js` ä¸­ä½¿ç”¨

```javascript
import "@babel/polyfill";

...
```

ç„¶åå†é‡æ–°è¿è¡Œ `npm run bundle`ï¼Œæˆ‘ä»¬ä¼šå‘ç°å‰åæ‰“åŒ…å‡ºæ¥çš„ `main.js` å¤§å°å·®äº†å¾ˆå¤šï¼š

![](./img/babel6.png)

![](./img/babel7.png)

è¿™æ˜¯å› ä¸º `@babel/polyfill` æŠŠæ‰€æœ‰çš„å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨çš„æ–¹æ³•éƒ½æ‰“åŒ…åˆ°äº† main.js ä¸­å»ï¼Œæ‰€ä»¥ä½“ç§¯ä¸€ä¸‹å­å°±å¤§äº†å¾ˆå¤šï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å®ç° `promise` å’Œ `map` å‡½æ•°å°±è¡Œäº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦æŒ‰éœ€å¼•å…¥ï¼Œä¿®æ”¹ `.babelrc` é…ç½®æ–‡ä»¶ï¼š

```json
{
	"presets": [
    [
      "@babel/preset-env",
      {
        "useBuiltIns": "usage"
      }
    ]
  ]
}
```

é‡æ–°è¿è¡Œ `npm run bundle`ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼šå‘ç°ä½“ç§¯å‡å°åˆ°äº† `140kb`ï¼š

![](./img/babel8.png)

åœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬ä¹Ÿå‘ç°ï¼Œå¦‚æœæ·»åŠ äº† `useBuiltIns` é…ç½®æ—¶ï¼Œå°±ä¸éœ€è¦å¯¼å…¥  `@babel/polyfill` äº†ã€‚

åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®æµè§ˆå™¨ç‰ˆæœ¬å»å‘Šè¯‰ `webpack` æ˜¯å¦è¦å‘æ‰“åŒ…çš„æ–‡ä»¶ä¸­æ³¨å…¥ä¸€äº›å…¼å®¹æ€§çš„ä»£ç ï¼š

```javascript
{
	"presets": [
    [
      "@babel/preset-env",
      {
        "targets": {
          "chrome": "67",
          "browsers": ["last 2 versions","safari 7"]
        },
        "useBuiltIns": "usage"
      }
    ]
  ]
}
```

ä¸Šé¢çš„ä»£ç çš„æ„æ€å°±æ˜¯ é’ˆå¯¹å¤§éƒ¨åˆ†æµè§ˆå™¨æœ€æ–°çš„ä¸¤ä¸ªç‰ˆæœ¬ä»¥åŠ `IE 7+` ä»¥åŠ `chrome25`ç‰ˆæœ¬è¿›è¡Œè½¬ç ç¼–è¯‘ï¼Œé«˜ç‰ˆæœ¬ `chrome` æµè§ˆå™¨å·²ç»æ”¯æŒäº† `es6`ï¼Œå°±ä¸å†å»æ‰“åŒ…æ³¨å…¥ç›¸åº”çš„ä»£ç äº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰“åŒ…å‡ºæ¥çš„ `main.js` æ–‡ä»¶çš„ä½“ç§¯å˜æˆäº† `122kb`ï¼š

![](./img/babel9.png)



## æ‰“åŒ…ç±»åº“

å½“æˆ‘ä»¬å®ç°è‡ªå·±çš„ç±»åº“çš„æ—¶å€™ï¼Œå¹¶æƒ³è®©ç±»åº“èƒ½åœ¨ä½ç«¯ç‰ˆæœ¬æµè§ˆå™¨ä¸­è¿è¡Œï¼Œ

å¦‚æœä½¿ç”¨äº† `@babel/polyfill`ï¼Œå› ä¸ºä»–è¦æ³¨å…¥ä¸€äº›ä½ç«¯æµè§ˆå™¨æ‰€éœ€è¦çš„æ–¹æ³•ï¼Œä»–ä¼šé‡‡å–ä¸€ç§å…¨å±€æ³¨å…¥çš„æ–¹å¼ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šå½±å“å…¨å±€ç¯å¢ƒã€‚



æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬å°±è¦æ¢ä¸€ç§æ‰“åŒ…çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `@babel/plugin-transform-runtime` æ¥å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç…§ç€ [å®˜ç½‘çš„æ­¥éª¤](https://www.babeljs.cn/docs/babel-plugin-transform-runtime) ä¸€æ­¥ä¸€æ­¥æ¥ã€‚

* é¦–å…ˆå®‰è£…ä¾èµ–

```javascript
npm install @babel/plugin-transform-runtime @babel/runtime -D

npm install @babel/runtime @babel/runtime-corejs2 -S
```

* ä¿®æ”¹ `.babelrc` é…ç½®æ–‡ä»¶ï¼š

```javascript
{
  "plugins": [["@babel/plugin-transform-runtime", {
    "corejs": 2,
    "helpers": true,
    "regenerator": true,
    "useESModules": false
  }]]
}
```

* é‡æ–°è¿è¡Œ `npm run bundle`ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰“åŒ…æˆåŠŸï¼Œè¾“å‡ºå¦‚ä¸‹å›¾ï¼š

![](./img/babel10.png)

æ›´å¤šçš„é…ç½®å¤§å®¶å¯ä»¥å‚è€ƒå®˜ç½‘ï¼š[@babel/plugin-transform-runtime](https://www.babeljs.cn/docs/babel-plugin-transform-runtime)



## ç¤ºä¾‹ä»£ç 

ç¤ºä¾‹ä»£ç å¯ä»¥çœ‹è¿™é‡Œï¼š

* [æ‰“åŒ… ES6 ç¤ºä¾‹ä»£ç ]()





